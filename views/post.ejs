<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Tables </title>
    <link href="/dist/css/styles.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet"
        crossorigin="anonymous" />
    <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js"
        crossorigin="anonymous"></script>
    <!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> 
     <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style rel="stylesheet">
        .ellipsis {
            max-height: 14px;
            max-width: 140px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>

<body class="sb-nav-fixed" style="font-family: 'Baloo 2', cursive; font-size: 17px;">

    <div>
        <%- include('./partitions/header'); %>
    </div>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading"> MAIN NAVIGATION </div>
                        <a class="nav-link" href="/post/admin">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Add Post
                        </a>


                    </div>
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid">
                    <h1 class="mt-4">Blog</h1>
                    <div id="accordion" class="mb-4">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <h5 class="mb-0">
                                    <button id="accr" class="btn btn-link collapsed" data-toggle="collapse"
                                        data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        Add Post
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne"
                                data-parent="#accordion">
                                <div class="card-body">
                                    <form method="post" action="/post/admin" enctype="multipart/form-data">

                                        <div class="row">

                                            <div class="form-row col-md-9">

                                                <div class="form-group col-md-3">
                                                    <label>Post Title</label>
                                                    <input name="post_title" type="text" class="form-control"
                                                        id="post_title" placeholder="post title" value="">
                                                </div>

                                                <div class="form-group col-md-3">
                                                    <label>Post Link</label>
                                                    <input name="post_link" type="text" class="form-control"
                                                        id="post_link" placeholder="post link">
                                                </div>
                                                <div class="form-group col-md-3">
                                                    <label>Author</label>
                                                    <input name="author" type="text" class="form-control" id="author"
                                                        placeholder="author">
                                                </div>

                                                <div class="form-group col-md-3">
                                                    <label for="main_tag">Main Category</label>
                                                    <select class="form-control js-example-basic-single"
                                                        name="post_category" id="post_category" style="width: 100%;"
                                                        value="">
                                                        <option value disabled selected> Choose..</option>
                                                        <% MCatList.forEach(function(cat){ %>
                                                            <option value="<%= cat.name %>">
                                                                <%= cat.name %>
                                                            </option>
                                                            <% }) %>
                                                    </select>
                                                </div>
                                                <div class="form-group col-md-3">
                                                    <label for="id_label_multiple">Sub tag</label>
                                                    <select
                                                        class="form-control js-example-basic-multiple mdb-select md-form"
                                                        name="post_subCategory" multiple="multiple"
                                                        id="id_label_multiple" style="width: 100%;" value="">
                                                        <% SCatList.forEach(function(cat){ %>
                                                            <option value="<%= cat.name %>">
                                                                <%= cat.name %>
                                                            </option>
                                                            <% }) %>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-row col-md-9">



                                                <div class="form-group date col-md-3">
                                                    <label>Schedule Time</label>
                                                    <input name="schedule_time" type="text" class="form-control"
                                                        id="datetime" placeholder="schedule time" value="">
                                                </div>

                                                <div class="form-group date col-md-3">
                                                    <label>Meta Description</label>
                                                    <input name="meta_description" type="text" class="form-control"
                                                        id="meta_description" placeholder="meta_description" value="">
                                                </div>

                                            </div>

                                            <div class="form-row col-md-9">
                                                <!-- <input name="blog_description" type="text" class="form-control"
                                                    id="summer" placeholder="schedule time" value=""> -->
                                                <textarea id="summernote" name="post_description"></textarea>

                                            </div>

                                            <div class="form-group col-md-3"
                                                style="text-align: center; margin-top: 17px;">

                                                <input type="file" id="files" name="image">
                                                <!-- <label for="files">
                                                        <img id="blah" class="img-circle"
                                                            src="http://52.66.231.200/femalehomeworkout/asset/images/users/user.png"
                                                            alt=""
                                                            style="width: 130px; height: 130px; BORDER-RADIUS: 355PX;">
                                                    </label> -->

                                            </div>

                                            <div class="form-group col-md-3"
                                                style="text-align: center; margin-top: 17px;">
                                                <input type="file" name="video" class="hidden" accept="video/*"
                                                    style="opacity: 1;">
                                                <label for="files">
                                                    <video id="vid" class="img-circle"
                                                        src="http://52.66.231.200/femalehomeworkout/asset/images/users/user.png"
                                                        alt=""
                                                        style="width: 130px; height: 130px; BORDER-RADIUS: 355PX;"></video>
                                                </label>
                                            </div>

                                        </div>

                                        <input type="text" name="updateId" id="updateId" value="" hidden>
                                        <button type="submit" class="btn btn-primary">Add</button>


                                    </form>
                                    <a href="/post/admin"><button class="btn btn-primary my-2">Cancel</button></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-table mr-1"></i>
                            Blog
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">

                                    <thead>

                                        <tr>
                                            <th scope="col">
                                                <i class="fa fa-trash" type="buttton" id="deleteAcc"
                                                    style="color: red;"></i>
                                                <span><input id="select_all" type="checkbox"></span>
                                            </th>
                                            <th>Image</th>
                                            <th>Post Name</th>
                                            <th>Post Link</th>
                                            <th>Meta Description</th>
                                            <th>Post Category</th>
                                            <th>Author</th>
                                            <th>Post Tag</th>
                                            <th>Description</th>
                                            <th>Schedule Time</th>
                                            <th>created time</th>
                                            <th>Like</th>
                                            <th>Action</th>
                                        </tr>

                                    </thead>

                                    <tbody>

                                        <% if(posts !==false) {%>
                                            <% posts.forEach(function(post) { %>
                                                <tr>

                                                    <td>
                                                        <input type="checkbox" value="<%= post._id %>">
                                                    </td>
                                                    <td>
                                                        <img src="https://blog-shot.s3.ap-south-1.amazonaws.com/post/<%= post.image %>"
                                                            alt="no image" style="width:100px; height:100px;">
                                                    </td>
                                                    <td>
                                                        <%= post.post_title %>
                                                    </td>
                                                    <td>
                                                        <%= post.post_link %>
                                                    </td>
                                                    <td>
                                                        <%= post.meta_description %>
                                                    </td>
                                                    <td>
                                                        <%= post.post_category %>
                                                    </td>
                                               
                                                    <td>
                                                        <%= post.author %>
                                                    </td>
                                                    <td >
                                                        <%= post.post_subCategory %>

                                                    </td>
                                                    <td class="ellipsis">
                                                        <%- post.post_description %>
                                                    </td>
                                                    <td>
                                                        <%= post.schedule_time %>
                                                    </td>
                                                    <td>
                                                        <%= post.createdAt %>
                                                    </td>
                                                    <td>
                                                        <%= post.post_like %>
                                                    </td>
                                                    <td>

                                                        <!-- <i class="fa fa-trash" type="button"
                                                                            style="color: red;"></i> -->

                                                        <a href="/post/preupdate/<%= post._id %>"><i
                                                                class="fa fa-wrench" aria-hidden="true"
                                                                onclick="openCol()"></i></a>
                                                    </td>

                                                </tr>

                                                <% }) %>
                                                    <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <%- include('./partitions/footer'); %>
        </div>
    </div>

    SCRIPTS
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <script src="/dist/js/scripts.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
    <script src="/dist/assets/demo/datatables-demo.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script> -->
    <!-- <script src="https://cdn.ckeditor.com/ckeditor5/27.0.0/classic/ckeditor.js"></script> -->

    <script>

        $(document).ready(function () {

            $('#summernote').summernote();
            // $editor.summernote({
            //     onPaste: function (e) {
            //         var bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text');
            //         e.preventDefault();
            //         document.execCommand('insertText', false, bufferText);
            //     }
            // }); 

            // CATEGORY SELECTION ##############################
            $('.js-example-basic-multiple').select2();
            $('.js-example-basic-single').select2();

            // TEXT EDITOR #######################
            // CKEDITOR.replace('blog_description');

            // ClassicEditor.create(document.querySelector("#blog_description"));

            // DELETE SECTION ###########################
            $("#select_all").change(function () {  //"select all" change 
                console.log("all chekced");
                var status = this.checked; // "select all" checked status
                $('input:checkbox').each(function () { //iterate all listed checkbox items
                    console.log('everyone checked');
                    this.checked = status; //change ".checkbox" checked status
                });
            });

            $('input:checkbox').change(function () {
                console.log('selected checked');
                if (this.checked == false) {
                    $("#select_all")[0].checked = false;
                }
                if ($('input:checkbox:checked').length == $('input:checkbox').length) {
                    $("#select_all")[0].checked = true;
                }
            });

            $('#deleteAcc').on('click', function () {
                var item = [];
                if ($('input:checkbox:checked').length > 0) {
                    $('input:checkbox:checked').each(function () {
                        item.push($(this).attr('value'));
                        item = item.filter(function (element) {
                            return element !== undefined
                        })
                    });
                    var cnfrm = confirm("do you really want to delete data")
                    if (cnfrm) {
                        delTable(item);
                    }
                }
                console.log(item);
            });

            function delTable(item) {
                $.ajax({
                    type: 'POST',
                    url: "/post/delBlog",
                    data: { item: item },
                    success: function (data) {
                        location.reload();
                    }
                });
            }

            // UPDATE SECTION #######################
            // setTimeout(() => {



            // }, 1000);
            // IMAGE READ ###################################
            var loadFile = function (event) {
                var reader = new FileReader();
                reader.onload = function () {
                    var output = document.getElementById('blah');
                    output.src = reader.result;
                };
                reader.readAsDataURL(event.target.files[0]);
            };

            // COLLAPSE OF ADD/UPDATE ############### NOT SURE


            // SCHEDULE TIME ################################
            $("#datetime").flatpickr({
                enableTime: true,
                dateFormat: "Y-m-d H:i",
            });

            if ("<%= updatePost.test %>" == "test") {
                console.log("<%= updatePost._id %>");
                let updt = "<%= updatePost.post_description %>"
                console.log(updt)
                var decodedText = $("<p/>").html(updt).text();
                $("#summernote").summernote('editor.pasteHTML', decodedText);


                $("#blog_name").val("<%= updatePost.post_title %>");
                $("#blog_link").val("<%= updatePost.post_link %>");
                $("#meta_description").val("<%= updatePost.meta_description %>");
                $("#date").val("<%= updatePost.schedule_time %>");
                $("#blog_category").val("<%= updatePost.post_category %>");
                $("#author").val("<%= updatePost.author %>");
                $("#updateId").val("<%= updatePost._id %>");
                var subcatarr = "<%= updatePost.post_subCategory %>".split(',');
                $("#id_label_multiple").val(subcatarr);
                console.log("blog details: ");

                $("#datetime").val("<%= updatePost.schedule_time %>");
                $("#accr").click()
                // }blog

            }
            // DONT KNOW ###########################
            // var content_row = 1;
            // function addContent() {
            //     html = '<div id="content-row">';
            //     html += '<div class="form-group">';
            //     html += '<label class="col-sm-2">Page Content</label>';
            //     html += '<div class="col-sm-10">';
            //     html += '<textarea class="form-control" id="code_preview' + content_row + '" name="page_code[' + content_row + '][code]" style="height: 300px;"></textarea>';
            //     html += '</div>';
            //     html += '</div>';
            //     html += '</div>';
            //     $('#content-row').append(html);
            //     $('#code_preview' + content_row).summernote({ height: 300 });
            //     content_row++;
            // }
        })





        // function urltoFile(url, filename, mimeType) {
        //     $("#summernote").val
        //     // mimeType = mimeType || (url.match(/^data:([^;]+);/) || '')[1];
        //     // return (fetch(url)
        //     //     .then(function (res) { return res.arrayBuffer(); })
        //     //     .then(function (buf) { return new File([buf], filename, { type: mimeType }); })
        //     // );
        // }



    </script>

</body>

</html>